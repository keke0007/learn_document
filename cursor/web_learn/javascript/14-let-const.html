<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>let 和 const</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            border-radius: 5px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .output {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .warning {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>let 和 const</h1>
        
        <div class="section">
            <h2>1. let - 块作用域变量</h2>
            <button onclick="demoLet()">运行示例</button>
            <div id="let-output" class="output"></div>
        </div>
        
        <div class="section">
            <h2>2. const - 常量</h2>
            <button onclick="demoConst()">运行示例</button>
            <div id="const-output" class="output"></div>
        </div>
        
        <div class="section">
            <h2>3. 作用域对比（var vs let）</h2>
            <button onclick="demoScope()">运行示例</button>
            <div id="scope-output" class="output"></div>
        </div>
        
        <div class="section">
            <h2>4. 暂时性死区（Temporal Dead Zone）</h2>
            <button onclick="demoTDZ()">运行示例</button>
            <div id="tdz-output" class="output"></div>
            <div class="warning">
                <strong>注意：</strong>let 和 const 存在暂时性死区，在声明之前访问会报错
            </div>
        </div>
        
        <div class="section">
            <h2>5. 循环中的 let 和 const</h2>
            <button onclick="demoLoop()">运行示例</button>
            <div id="loop-output" class="output"></div>
        </div>
    </div>

    <script>
        function demoLet() {
            let output = "";
            
            // let 是块作用域
            {
                let x = 10;
                output += `块内 x: ${x}<br>`;
            }
            // console.log(x); // 错误：x 未定义
            
            // let 不能重复声明
            let name = "张三";
            // let name = "李四"; // 错误：不能重复声明
            
            // let 可以重新赋值
            name = "李四";
            output += `重新赋值后 name: ${name}<br>`;
            
            document.getElementById('let-output').innerHTML = output;
        }
        
        function demoConst() {
            let output = "";
            
            // const 必须初始化
            const PI = 3.14159;
            // const PI2; // 错误：必须初始化
            
            // const 不能重新赋值
            // PI = 3.14; // 错误：不能重新赋值
            
            output += `const PI: ${PI}<br>`;
            
            // const 对象可以修改属性
            const person = {
                name: "张三",
                age: 25
            };
            person.age = 26; // 可以修改
            person.city = "北京"; // 可以添加
            output += `const 对象: ${JSON.stringify(person)}<br>`;
            output += "注意：const 对象可以修改属性，但不能重新赋值整个对象<br>";
            
            // const 数组可以修改元素
            const arr = [1, 2, 3];
            arr.push(4); // 可以添加
            arr[0] = 10; // 可以修改
            output += `const 数组: [${arr.join(', ')}]<br>`;
            
            document.getElementById('const-output').innerHTML = output;
        }
        
        function demoScope() {
            let output = "";
            
            // var 函数作用域
            if (true) {
                var varVar = "var 变量";
            }
            output += `var 在 if 块外可访问: ${varVar}<br>`;
            
            // let 块作用域
            if (true) {
                let letVar = "let 变量";
                output += `let 在 if 块内: ${letVar}<br>`;
            }
            // letVar 在块外不可访问
            
            // for 循环中的 var
            output += "<br>for 循环中的 var:<br>";
            for (var i = 0; i < 3; i++) {
                setTimeout(() => {
                    // 所有回调都引用同一个 i
                }, 100);
            }
            output += `循环后 i: ${i} (var 在函数作用域)<br>`;
            
            // for 循环中的 let
            output += "<br>for 循环中的 let:<br>";
            for (let j = 0; j < 3; j++) {
                // 每次循环创建新的 j
            }
            // j 在循环外不可访问
            
            document.getElementById('scope-output').innerHTML = output;
        }
        
        function demoTDZ() {
            let output = "";
            
            // var 可以提升
            output += `var 提升: ${typeof hoistedVar}<br>`;
            var hoistedVar = "已提升";
            
            // let 和 const 不能提升（暂时性死区）
            // console.log(hoistedLet); // 错误：Cannot access before initialization
            let hoistedLet = "不能提升";
            
            output += `let 声明后: ${hoistedLet}<br>`;
            output += "let 和 const 在声明之前访问会报错（暂时性死区）<br>";
            
            document.getElementById('tdz-output').innerHTML = output;
        }
        
        function demoLoop() {
            let output = "";
            
            // var 在循环中
            output += "var 在循环中（所有回调共享同一个变量）:<br>";
            let varResults = [];
            for (var i = 0; i < 3; i++) {
                varResults.push(() => i);
            }
            output += `结果: ${varResults.map(fn => fn()).join(', ')} (都是3)<br>`;
            
            // let 在循环中
            output += "<br>let 在循环中（每次循环创建新变量）:<br>";
            let letResults = [];
            for (let j = 0; j < 3; j++) {
                letResults.push(() => j);
            }
            output += `结果: ${letResults.map(fn => fn()).join(', ')} (0, 1, 2)<br>`;
            
            // const 在 for...of 循环中
            output += "<br>const 在 for...of 循环中:<br>";
            const items = ['a', 'b', 'c'];
            let constResults = [];
            for (const item of items) {
                constResults.push(item);
            }
            output += `结果: [${constResults.join(', ')}]<br>`;
            
            document.getElementById('loop-output').innerHTML = output;
        }
        
        console.log("=== let 和 const 示例 ===");
        console.log("let: 块作用域，可重新赋值");
        console.log("const: 块作用域，不可重新赋值");
    </script>
</body>
</html>
