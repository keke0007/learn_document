# Java 服务故障排查指南

## 📚 项目概述

本指南提供了完整的 Java 服务故障排查学习资源，包括排查方法、工具使用、实战案例和验证数据，帮助你在 Linux 环境下快速定位和解决 Java 应用故障。

---

## 📁 项目结构

```
troubleshooting/
├── README.md                    # 故障排查知识点总览（详细文档）
├── GUIDE.md                     # 本指南文档（快速入门）
├── cases/                       # 实战案例目录
│   ├── log_analysis.md        # 案例1：日志分析
│   ├── memory_troubleshooting.md  # 案例2：内存问题排查
│   ├── cpu_troubleshooting.md  # 案例3：CPU 问题排查
│   ├── thread_troubleshooting.md  # 案例4：线程问题排查
│   └── comprehensive_troubleshooting.md  # 案例5：综合故障排查
├── data/                        # 验证数据目录
│   ├── application.log         # 应用日志
│   └── gc.log                  # GC 日志
└── scripts/                     # 排查脚本目录
    └── check_system.sh         # 系统检查脚本
```

---

## 🎯 学习路径

### 阶段一：排查基础（2-3天）
1. **故障排查流程**
   - 问题确认
   - 信息收集
   - 问题定位
   - 解决方案

2. **常用工具**
   - 系统工具（top、ps、netstat）
   - JVM 工具（jps、jstack、jmap）
   - 日志工具（grep、awk、sed）

### 阶段二：专项排查（3-4天）
1. **日志分析**
   - 日志查看和搜索
   - 错误统计和分析
   - 异常堆栈分析

2. **内存问题**
   - 内存溢出排查
   - 内存泄漏检测
   - GC 分析

### 阶段三：性能问题（3-4天）
1. **CPU 问题**
   - CPU 高占用定位
   - 线程 CPU 分析
   - 死循环检测

2. **线程问题**
   - 死锁检测
   - 线程泄漏
   - 线程阻塞

### 阶段四：综合应用（2-3天）
1. **综合故障排查**
   - 多维度分析
   - 问题定位流程
   - 排查报告生成

---

## 🚀 快速开始

### 前置要求

- Linux 系统
- Java 应用运行中
- JDK 工具（jps、jstack、jmap、jstat）
- 基本 Shell 脚本知识

### 步骤1：环境准备

```bash
# 检查 JDK 工具
which jps jstack jmap jstat

# 检查 Java 进程
jps -l

# 如果没有 Java 进程，可以启动一个测试应用
```

### 步骤2：运行排查脚本

```bash
# 创建输出目录
mkdir -p output

# 添加执行权限
chmod +x scripts/*.sh cases/*.sh

# 运行系统检查
./scripts/check_system.sh

# 运行日志分析
./cases/log_analysis.sh
```

### 步骤3：分析结果

查看 `output/` 目录下生成的报告文件，分析问题。

---

## 📖 核心知识点速查

### 1. 常用排查命令

| 工具 | 命令 | 说明 |
|------|------|------|
| **jps** | `jps -lvm` | 查看 Java 进程 |
| **jstack** | `jstack <pid>` | 线程转储 |
| **jmap** | `jmap -heap <pid>` | 堆内存信息 |
| **jstat** | `jstat -gc <pid>` | GC 统计 |
| **top** | `top -p <pid>` | 进程资源使用 |
| **ps** | `ps aux \| grep java` | 进程信息 |

### 2. 日志分析

| 操作 | 命令 | 说明 |
|------|------|------|
| **实时查看** | `tail -f log` | 实时查看日志 |
| **搜索错误** | `grep ERROR log` | 搜索错误 |
| **统计错误** | `grep -c ERROR log` | 统计错误数 |
| **时间范围** | `grep "09:00" log` | 按时间筛选 |

### 3. 内存排查

| 操作 | 命令 | 说明 |
|------|------|------|
| **堆转储** | `jmap -dump:format=b,file=heap.hprof <pid>` | 生成堆转储 |
| **堆信息** | `jmap -heap <pid>` | 查看堆信息 |
| **对象统计** | `jmap -histo <pid>` | 对象统计 |
| **GC 统计** | `jstat -gcutil <pid>` | GC 统计 |

### 4. CPU 排查

| 操作 | 命令 | 说明 |
|------|------|------|
| **进程 CPU** | `top -p <pid>` | 进程 CPU |
| **线程 CPU** | `top -H -p <pid>` | 线程 CPU |
| **线程堆栈** | `jstack <pid>` | 线程堆栈 |
| **系统调用** | `strace -p <pid>` | 系统调用 |

---

## 💡 实战案例概览

### 案例1：日志分析
**学习目标**：掌握日志分析方法

**涉及知识点**：
- 日志查看和搜索
- 错误统计和分类
- 异常堆栈分析
- 时间范围分析
- 报告生成

**数据规模**：
- 应用日志：15 条记录
- GC 日志：5 条记录

**典型操作**：
- 错误日志统计
- 异常类型分析
- 慢请求分析
- GC 分析

### 案例2：内存问题排查
**学习目标**：排查内存相关问题

**涉及知识点**：
- 内存监控
- 堆转储生成
- GC 分析
- 内存泄漏检测
- OutOfMemoryError 分析

**典型操作**：
- 内存使用监控
- 堆转储分析
- GC 统计
- 内存泄漏检测

### 案例3：CPU 问题排查
**学习目标**：排查 CPU 高占用问题

**涉及知识点**：
- CPU 监控
- 线程 CPU 分析
- 高 CPU 线程定位
- 死循环检测
- 线程堆栈分析

**典型操作**：
- 进程和线程 CPU 监控
- 高 CPU 线程定位
- 线程堆栈分析
- 死循环检测

### 案例4：线程问题排查
**学习目标**：排查线程相关问题

**涉及知识点**：
- 线程监控
- 死锁检测
- 线程泄漏检测
- 线程状态分析
- 锁分析

**典型操作**：
- 线程统计
- 死锁检测
- 线程泄漏检测
- 线程转储分析

### 案例5：综合故障排查
**学习目标**：综合故障排查流程

**涉及知识点**：
- 系统化排查流程
- 多维度信息收集
- 问题定位
- 报告生成
- 快速诊断

**典型操作**：
- 综合信息收集
- 快速诊断
- 问题定位
- 排查报告

---

## 📊 数据说明

### 日志文件

| 文件名 | 格式 | 记录数 | 用途 |
|--------|------|--------|------|
| application.log | 文本 | 15 行 | 应用日志 |
| gc.log | 文本 | 5 行 | GC 日志 |

### 日志内容

**application.log** 包含：
- INFO 日志：正常操作
- WARN 日志：警告信息
- ERROR 日志：错误和异常
- 异常堆栈：完整的堆栈跟踪

**gc.log** 包含：
- GC 事件：Young GC、Full GC
- GC 时间：GC 耗时
- 内存变化：GC 前后内存使用

---

## 🔧 使用技巧

### 1. 排查流程

```
问题现象 → 收集信息 → 分析定位 → 解决方案 → 验证修复
```

### 2. 信息收集清单

- [ ] 系统资源（CPU、内存、磁盘）
- [ ] 应用日志（错误、异常）
- [ ] JVM 信息（参数、堆内存）
- [ ] GC 日志
- [ ] 线程转储
- [ ] 堆转储（如需要）

### 3. 常见问题快速定位

**问题：应用响应慢**
```bash
# 1. 检查 CPU
top -p <pid>

# 2. 检查线程
jstack <pid> | grep RUNNABLE

# 3. 检查 GC
jstat -gcutil <pid>
```

**问题：内存溢出**
```bash
# 1. 查看堆内存
jmap -heap <pid>

# 2. 生成堆转储
jmap -dump:format=b,file=heap.hprof <pid>

# 3. 分析 GC 日志
grep "Full GC" gc.log
```

**问题：应用无响应**
```bash
# 1. 检查死锁
jstack <pid> | grep deadlock

# 2. 检查线程状态
jstack <pid> | grep "Thread.State"

# 3. 检查系统资源
top
free -h
```

---

## 📝 学习建议

### 初学者
1. 从日志分析开始，掌握基本排查方法
2. 学习常用工具的使用
3. 理解问题定位的思路
4. 多动手实践，积累经验

### 进阶学习
1. 深入学习 JVM 原理
2. 掌握性能分析工具
3. 学习系统调优
4. 建立排查知识库

### 实践建议
1. **建立流程**：形成自己的排查流程
2. **工具熟练**：熟练掌握常用工具
3. **经验积累**：记录常见问题和解决方案
4. **持续学习**：关注新技术和工具

---

## 🔗 相关资源

### 官方文档
- [Oracle JDK 工具文档](https://docs.oracle.com/javase/8/docs/technotes/tools/)
- [Linux 系统管理文档](https://www.kernel.org/doc/html/latest/)

### 推荐阅读
- `README.md` - 详细的知识点文档
- `cases/` - 五个实战案例的详细说明
- JVM 调优指南

### 扩展学习
- JVM 原理深入
- 性能分析工具（JProfiler、Arthas）
- 系统性能调优
- 容器环境排查

---

## ✅ 学习检查清单

完成以下任务，确保掌握故障排查核心技能：

### 基础操作
- [ ] 能够查看和分析日志
- [ ] 能够使用 JVM 工具
- [ ] 能够监控系统资源
- [ ] 能够生成线程和堆转储

### 进阶操作
- [ ] 能够排查内存问题
- [ ] 能够排查 CPU 问题
- [ ] 能够排查线程问题
- [ ] 能够进行综合故障排查

### 实战能力
- [ ] 完成案例1的日志分析
- [ ] 完成案例2的内存排查
- [ ] 完成案例3的 CPU 排查
- [ ] 完成案例4的线程排查
- [ ] 完成案例5的综合排查
- [ ] 能够独立排查实际故障

---

## 🎓 学习成果

完成本指南的学习后，你将能够：
- ✅ 熟练使用各种排查工具
- ✅ 掌握日志分析方法
- ✅ 能够排查内存、CPU、线程问题
- ✅ 理解故障排查的流程和方法
- ✅ 具备快速定位和解决故障的能力
- ✅ 掌握故障排查的最佳实践

**祝你学习愉快！** 🚀

---

## 📌 快速参考

### 常用排查命令

```bash
# 查找 Java 进程
jps -lvm

# 查看进程资源
top -p <pid>
ps aux | grep java

# 线程转储
jstack <pid> > thread_dump.txt

# 堆转储
jmap -dump:format=b,file=heap.hprof <pid>

# GC 统计
jstat -gcutil <pid> 1000

# 查看日志
tail -f application.log
grep ERROR application.log
```

### 问题定位流程

```
1. 查看日志 → 2. 检查资源 → 3. 分析线程 → 4. 生成转储 → 5. 深入分析
```

### 紧急处理

```bash
# 应用无响应
jstack <pid> > thread_dump.txt  # 保存线程转储
jmap -dump:format=b,file=heap.hprof <pid>  # 保存堆转储

# 内存溢出
jmap -heap <pid>  # 查看堆内存
jstat -gc <pid>   # 查看 GC

# CPU 高占用
top -H -p <pid>   # 查看线程 CPU
jstack <pid> | grep -A 10 "RUNNABLE"  # 查看运行线程
```
