# MongoDB å­¦ä¹ æŒ‡å—ï¼ˆåŸºç¡€ & è¿›é˜¶ï¼‰

## ğŸ“š é¡¹ç›®æ¦‚è¿°

æœ¬æŒ‡å—åœ¨ `mongoDB/` ç›®å½•ä¸‹ï¼Œå‚è€ƒ `hive/`ã€`clickhouse/`ã€`doris/`ã€`oracle/`ã€`PostgreSQL/` æ¨¡å—çš„ç»„ç»‡æ–¹å¼ï¼Œæä¾›ä¸€å¥—ç³»ç»Ÿçš„ **MongoDB å­¦ä¹ è·¯å¾„**ï¼Œé‡ç‚¹è¦†ç›–ï¼š

- **æ ¸å¿ƒçŸ¥è¯†ç‚¹**ï¼šæ–‡æ¡£æ¨¡å‹ã€é›†åˆä¸æ•°æ®åº“ã€CRUD æ“ä½œã€ç´¢å¼•ã€èšåˆç®¡é“ï¼ˆAggregation Pipelineï¼‰ã€äº‹åŠ¡ï¼ˆå¤šæ–‡æ¡£äº‹åŠ¡ç®€ä»‹ï¼‰ã€å‰¯æœ¬é›†ä¸åˆ†ç‰‡ï¼ˆäº†è§£ï¼‰  
- **æ¡ˆä¾‹åœºæ™¯**ï¼šç”¨æˆ·ä¸è®¢å•æ–‡æ¡£å»ºæ¨¡ã€è®¢å•ä¸é”€å”®åˆ†æã€æ—¥å¿—/äº‹ä»¶ JSON æ–‡æ¡£åˆ†æ  
- **éªŒè¯æ•°æ®**ï¼šå°è§„æ¨¡ JSON/JSONL ç¤ºä¾‹æ•°æ®ï¼ˆç”¨æˆ·ã€è®¢å•ã€äº‹ä»¶æ—¥å¿—ï¼‰ï¼Œæ–¹ä¾¿åœ¨æœ¬åœ° MongoDB å®ä¾‹ä¸­åŠ¨æ‰‹ç»ƒä¹ 

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
mongoDB/
â”œâ”€â”€ README.md                      # MongoDB çŸ¥è¯†ç‚¹æ€»è§ˆï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰
â”œâ”€â”€ GUIDE.md                       # æœ¬æŒ‡å—æ–‡æ¡£ï¼ˆå­¦ä¹ è·¯å¾„ + å¿«é€Ÿä¸Šæ‰‹ï¼‰
â”œâ”€â”€ cases/                         # å®æˆ˜æ¡ˆä¾‹ç›®å½•
â”‚   â”œâ”€â”€ user_profile_modeling.md   # æ¡ˆä¾‹1ï¼šç”¨æˆ·æ–‡æ¡£ä¸åµŒå¥—ç»“æ„å»ºæ¨¡
â”‚   â”œâ”€â”€ order_sales_analysis.md    # æ¡ˆä¾‹2ï¼šè®¢å•ä¸é”€å”®åˆ†æï¼ˆèšåˆç®¡é“ï¼‰
â”‚   â””â”€â”€ event_log_analysis.md      # æ¡ˆä¾‹3ï¼šäº‹ä»¶/æ—¥å¿—èšåˆåˆ†æ
â”œâ”€â”€ data/                          # éªŒè¯æ•°æ®ï¼ˆJSON/JSONLï¼‰
â”‚   â”œâ”€â”€ users.json                 # ç”¨æˆ·æ•°æ®ï¼ˆçº¦8æ¡ï¼‰
â”‚   â”œâ”€â”€ orders.json                # è®¢å•æ•°æ®ï¼ˆçº¦15æ¡ï¼‰
â”‚   â””â”€â”€ events.jsonl               # äº‹ä»¶æ—¥å¿—ï¼ˆçº¦15æ¡ï¼‰
â””â”€â”€ scripts/                       # mongo Shell / mongosh è„šæœ¬
    â”œâ”€â”€ setup_collections.js       # åˆ›å»ºæ•°æ®åº“/é›†åˆä¸ç´¢å¼•
    â”œâ”€â”€ load_data.js               # åŠ è½½ç¤ºä¾‹æ•°æ®
    â””â”€â”€ common_queries.js          # å¸¸ç”¨æŸ¥è¯¢ä¸èšåˆç¤ºä¾‹
```

---

## ğŸ¯ å­¦ä¹ è·¯å¾„ï¼ˆå»ºè®® 3~5 å¤©ï¼‰

### é˜¶æ®µä¸€ï¼šåŸºç¡€å…¥é—¨ï¼ˆ0.5~1 å¤©ï¼‰

1. **MongoDB åŸºæœ¬æ¦‚å¿µ**
   - æ–‡æ¡£ï¼ˆDocumentï¼‰ã€é›†åˆï¼ˆCollectionï¼‰ã€æ•°æ®åº“ï¼ˆDatabaseï¼‰
   - JSON / BSON æ ¼å¼
   - ä¸å…³ç³»å‹æ•°æ®åº“å¯¹æ¯”ï¼šè¡¨/è¡Œ/åˆ— vs é›†åˆ/æ–‡æ¡£/å­—æ®µ

2. **åŸºç¡€æ“ä½œ**
   - å¯åŠ¨æœ¬åœ° MongoDB å®ä¾‹ï¼ˆ`mongod`ï¼‰
   - ä½¿ç”¨ `mongosh` æˆ–å›¾å½¢å·¥å…·ï¼ˆCompassï¼‰
   - åŸºæœ¬å‘½ä»¤ï¼š`show dbs`ã€`use db`ã€`show collections`

### é˜¶æ®µäºŒï¼šCRUD ä¸æ–‡æ¡£å»ºæ¨¡ï¼ˆ1~2 å¤©ï¼‰

1. **CRUD æ“ä½œ**
   - æ’å…¥ï¼š`insertOne` / `insertMany`
   - æŸ¥è¯¢ï¼š`find`ã€æŠ•å½±ã€æ’åºã€åˆ†é¡µï¼ˆ`limit` / `skip`ï¼‰
   - æ›´æ–°ï¼š`updateOne` / `updateMany`ï¼ˆ`$set`ã€`$inc`ã€`$push` ç­‰ï¼‰
   - åˆ é™¤ï¼š`deleteOne` / `deleteMany`

2. **æ–‡æ¡£å»ºæ¨¡**
   - åµŒå…¥æ–‡æ¡£ vs å¼•ç”¨ï¼šä½•æ—¶åµŒå¥—ã€ä½•æ—¶æ‹†è¡¨
   - ç”¨æˆ·åŠå…¶åœ°å€/æ ‡ç­¾ï¼ˆæ¡ˆä¾‹1ï¼‰
   - ç”¨æˆ·ä¸è®¢å•å…³ç³»å»ºæ¨¡ï¼ˆæ¡ˆä¾‹2ï¼‰

3. **ç´¢å¼•**
   - å•å­—æ®µç´¢å¼•ã€å¤åˆç´¢å¼•
   - å”¯ä¸€ç´¢å¼•ï¼ˆ`unique`ï¼‰

### é˜¶æ®µä¸‰ï¼šèšåˆä¸åˆ†æï¼ˆ1~2 å¤©ï¼‰

1. **èšåˆç®¡é“åŸºç¡€**
   - `$match` / `$project` / `$group` / `$sort` / `$limit` / `$lookup`
   - åœ¨è®¢å•é›†åˆä¸Šç»Ÿè®¡é”€å”®é¢ï¼ˆæ¡ˆä¾‹2ï¼‰

2. **äº‹ä»¶æ—¥å¿—åˆ†æ**
   - å­˜å‚¨äº‹ä»¶ JSONï¼ˆæ¡ˆä¾‹3ï¼‰
   - ç»Ÿè®¡ PVã€äº‹ä»¶ç±»å‹åˆ†å¸ƒã€æŒ‰æ—¶é—´èšåˆ

3. **ç®€å•äº‹åŠ¡ä¸å¤šæ–‡æ¡£æ“ä½œï¼ˆäº†è§£ï¼‰**
   - å•æ–‡æ¡£å†™å…¥å¤©ç„¶åŸå­æ€§
   - å¤šæ–‡æ¡£äº‹åŠ¡ï¼ˆéœ€è¦å‰¯æœ¬é›†/åˆ†ç‰‡é›†ç¾¤ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

> ä»¥ä¸‹ç¤ºä¾‹å‡å®šä½ å·²åœ¨æœ¬æœºå®‰è£… MongoDBï¼Œå¹¶èƒ½é€šè¿‡ `mongosh` è¿æ¥ã€‚

### æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“ä¸é›†åˆ

åœ¨ `mongosh` ä¸­æ‰§è¡Œï¼š

```javascript
use bigdata_mongo;

// è¿è¡Œè„šæœ¬
load("scripts/setup_collections.js");
```

### æ­¥éª¤2ï¼šåŠ è½½ç¤ºä¾‹æ•°æ®

```javascript
use bigdata_mongo;
load("scripts/load_data.js");
```

æˆ–åœ¨è„šæœ¬ä¸­ä½¿ç”¨ `mongoimport` æ€è·¯ä» JSON/JSONL æ–‡ä»¶å¯¼å…¥ï¼ˆè§ `scripts/load_data.js` æ³¨é‡Šï¼‰ã€‚

### æ­¥éª¤3ï¼šæ‰§è¡Œå¸¸ç”¨æŸ¥è¯¢ä¸èšåˆ

```javascript
use bigdata_mongo;
load("scripts/common_queries.js");
```

ç¤ºä¾‹ï¼ˆåœ¨ `common_queries.js` å†…ä¹Ÿä¼šåŒ…å«ç±»ä¼¼è¯­å¥ï¼‰ï¼š

```javascript
// æŸ¥è¯¢éƒ¨åˆ†ç”¨æˆ·
db.users.find({}, { name: 1, city: 1 }).limit(5);

// ç®€å•è®¢å•ç»Ÿè®¡
db.orders.aggregate([
  { $group: { _id: null, totalSales: { $sum: "$total_amount" }, orderCount: { $sum: 1 } } }
]);
```

---

## ğŸ“– æ ¸å¿ƒçŸ¥è¯†ç‚¹é€ŸæŸ¥

### 1. æ–‡æ¡£ç¤ºä¾‹ï¼ˆç”¨æˆ·ï¼‰

```json
{
  "_id": ObjectId("..."),
  "user_id": 1,
  "name": "å¼ ä¸‰",
  "age": 25,
  "city": "åŒ—äº¬",
  "tags": ["é‡‘å¡", "é«˜ä»·å€¼"],
  "addresses": [
    { "type": "home", "city": "åŒ—äº¬", "detail": "æœé˜³åŒº..." },
    { "type": "work", "city": "åŒ—äº¬", "detail": "ä¸­å…³æ‘..." }
  ],
  "register_date": ISODate("2023-01-01T00:00:00Z")
}
```

### 2. å¸¸ç”¨æŸ¥è¯¢/æ›´æ–°è¯­æ³•

```javascript
// æŸ¥è¯¢
db.users.find({ city: "åŒ—äº¬", age: { $gte: 25 } }).sort({ age: -1 }).limit(10);

// æ›´æ–°
db.users.updateOne(
  { user_id: 1 },
  { $set: { city: "ä¸Šæµ·" }, $inc: { age: 1 } }
);

// æ’å…¥
db.users.insertOne({ user_id: 9, name: "æ–°ç”¨æˆ·", age: 20 });
```

### 3. ç®€å•èšåˆç®¡é“ç¤ºä¾‹

```javascript
// æŒ‰åŸå¸‚ç»Ÿè®¡ç”¨æˆ·æ•°
db.users.aggregate([
  { $group: { _id: "$city", userCount: { $sum: 1 } } },
  { $sort: { userCount: -1 } }
]);

// æŒ‰æœˆä»½ç»Ÿè®¡è®¢å•é‡‘é¢
db.orders.aggregate([
  {
    $group: {
      _id: { $substr: ["$order_date", 0, 7] }, // "YYYY-MM"
      monthlySales: { $sum: "$total_amount" },
      orderCount: { $sum: 1 }
    }
  },
  { $sort: { "_id": 1 } }
]);
```

---

## ğŸ“Š éªŒè¯æ•°æ®è¯´æ˜

### æ•°æ®æ–‡ä»¶æ¸…å•

| æ–‡ä»¶å         | è®°å½•æ•°ï¼ˆçº¦ï¼‰ | ç”¨é€”         | æ¡ˆä¾‹   |
|----------------|--------------|--------------|--------|
| `users.json`   | 8            | ç”¨æˆ·æ–‡æ¡£     | æ¡ˆä¾‹1  |
| `orders.json`  | 15           | è®¢å•æ–‡æ¡£     | æ¡ˆä¾‹2  |
| `events.jsonl` | 15           | äº‹ä»¶æ—¥å¿—     | æ¡ˆä¾‹3  |

å­—æ®µ/ç»“æ„ç¤ºä¾‹ï¼š
- `users.json`ï¼šä¸æ–‡æ¡£ç¤ºä¾‹ç±»ä¼¼ï¼ˆ`user_id,name,age,city,tags,addresses` ç­‰ï¼‰  
- `orders.json`ï¼š`order_id,user_id,order_date,city,product,quantity,total_amount,status` ç­‰  
- `events.jsonl`ï¼šæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼Œå¦‚ï¼š

```json
{"ts":"2024-03-14T10:00:01","user_id":1,"event_type":"page_view","page":"/home","device":"ios","duration":12}
```

---

## ğŸ”§ å®æˆ˜æ¡ˆä¾‹æ¦‚è§ˆ

### æ¡ˆä¾‹1ï¼šç”¨æˆ·æ–‡æ¡£ä¸åµŒå¥—ç»“æ„å»ºæ¨¡

**å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡ MongoDB çš„æ–‡æ¡£æ¨¡å‹ä¸åµŒå¥—ç»“æ„è®¾è®¡ã€‚  
**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- æ–‡æ¡£ä¸é›†åˆ
- åµŒå…¥å­æ–‡æ¡£ä¸æ•°ç»„å­—æ®µ
- åŸºæœ¬æŸ¥è¯¢ä¸ç´¢å¼•

### æ¡ˆä¾‹2ï¼šè®¢å•ä¸é”€å”®åˆ†æï¼ˆèšåˆç®¡é“ï¼‰

**å­¦ä¹ ç›®æ ‡**ï¼šä½¿ç”¨ Aggregation Pipeline å®Œæˆå¤šç»´é”€å”®ç»Ÿè®¡ã€‚  
**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- `$match / $group / $project / $sort` ç­‰é˜¶æ®µ
- æŒ‰æ—¶é—´/åŸå¸‚/ç”¨æˆ·ç»´åº¦ç»Ÿè®¡é”€å”®æŒ‡æ ‡

### æ¡ˆä¾‹3ï¼šäº‹ä»¶/æ—¥å¿—èšåˆåˆ†æ

**å­¦ä¹ ç›®æ ‡**ï¼šåŸºäº JSON æ—¥å¿—é›†åˆåšç®€å•è¡Œä¸ºåˆ†æã€‚  
**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- JSON æ–‡æ¡£å­˜å‚¨
- æŒ‰äº‹ä»¶ç±»å‹/é¡µé¢/è®¾å¤‡ç»Ÿè®¡ PV ä¸è¡Œä¸ºåˆ†å¸ƒ

---

## ğŸ“ å­¦ä¹ å»ºè®®

### é’ˆå¯¹å·²æœ‰ SQL/å…³ç³»å‹åŸºç¡€çš„åŒå­¦

1. å°† MongoDB ç†è§£ä¸º **é¢å‘æ–‡æ¡£ã€æ”¯æŒçµæ´» schema ä¸èšåˆåˆ†æçš„ NoSQL æ•°æ®åº“**ã€‚  
2. ä¼˜å…ˆæŒæ¡ï¼šæ–‡æ¡£å»ºæ¨¡ï¼ˆåµŒå…¥ vs å¼•ç”¨ï¼‰ã€CRUDã€ç´¢å¼•ä¸èšåˆç®¡é“ã€‚  
3. å¯¹æ¯” MySQL/Oracle/PostgreSQLï¼šå“ªäº›åœºæ™¯é€‚åˆæ”¾åœ¨ MongoDBï¼Ÿå“ªäº›ä»ç„¶æ›´é€‚åˆå…³ç³»å‹æ•°æ®åº“ï¼Ÿ

### å®è·µè·¯çº¿

1. æŒ‰ `scripts/setup_collections.js` + `load_data.js` è·‘é€šä¸‰ä¸ªé›†åˆçš„åˆ›å»ºä¸æ•°æ®å¯¼å…¥ã€‚  
2. é€æ¡æ‰§è¡Œ `scripts/common_queries.js` ä¸­çš„æŸ¥è¯¢ï¼Œç†è§£æ¯ä¸ªèšåˆé˜¶æ®µå«ä¹‰ã€‚  
3. æ ¹æ®è‡ªèº«ä¸šåŠ¡ï¼Œå°è¯•è®¾è®¡ä¸€ä¸ªæ–°çš„é›†åˆä¸ä¸¤ä¸ªèšåˆæŠ¥è¡¨ã€‚

---

## âœ… å­¦ä¹ æ£€æŸ¥æ¸…å•

### åŸºç¡€èƒ½åŠ›
- [ ] èƒ½å¤Ÿè¿æ¥æœ¬åœ° MongoDB å¹¶åˆ‡æ¢åˆ° `bigdata_mongo` æ•°æ®åº“  
- [ ] èƒ½å¤Ÿåˆ›å»ºé›†åˆä¸ç´¢å¼•  
- [ ] èƒ½å¤Ÿå®ŒæˆåŸºæœ¬çš„æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ“ä½œ  

### è¿›é˜¶èƒ½åŠ›
- [ ] èƒ½å¤Ÿè®¾è®¡åˆç†çš„æ–‡æ¡£ç»“æ„ï¼ˆåµŒå…¥ vs å¼•ç”¨ï¼‰  
- [ ] èƒ½å¤Ÿç¼–å†™å¤šä¸ªé˜¶æ®µçš„èšåˆç®¡é“å®Œæˆç»Ÿè®¡åˆ†æ  
- [ ] èƒ½å¤ŸåŸºäºè®¿é—®æ¨¡å¼è®¾è®¡ç´¢å¼•å¹¶éªŒè¯æ•ˆæœ  

---

## ğŸ“ å­¦ä¹ æˆæœ

å®Œæˆæœ¬æŒ‡å—åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- âœ… ä½¿ç”¨ MongoDB å®Œæˆå¸¸è§çš„æ–‡æ¡£å»ºæ¨¡ã€CRUD å’ŒæŸ¥è¯¢  
- âœ… ä½¿ç”¨ Aggregation Pipeline å¯¹è®¢å•ä¸æ—¥å¿—è¿›è¡Œå¤šç»´åº¦ç»Ÿè®¡  
- âœ… ç†è§£ MongoDB åœ¨â€œJSON/æ–‡æ¡£å­˜å‚¨ + çµæ´»åˆ†æâ€åœºæ™¯ä¸‹çš„ä¼˜åŠ¿ä¸é€‚ç”¨èŒƒå›´  

**ç¥ä½  MongoDB å­¦ä¹ é¡ºåˆ©ï¼ğŸš€**

