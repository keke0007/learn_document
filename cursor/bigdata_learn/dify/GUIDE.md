# Dify 学习指南（LLM 应用开发平台）

## 📚 项目概述

本指南在 `dify/` 目录下，参考本项目其他模块的输出方式，整理 **Dify 学习知识点 + 案例 + 验证数据**，帮助你快速掌握：

- **应用类型**：Chat / Completion / Workflow（工作流）等应用形态
- **RAG 知识库**：数据集、切分、检索、引用与评测
- **工具与集成**：API/HTTP 工具、函数调用、外部系统对接
- **工程化**：环境部署、权限与密钥、可观测与成本、版本迭代

---

## 📁 项目结构

```
dify/
├── README.md                         # Dify 知识点总览（详细文档）
├── GUIDE.md                          # 本指南文档（快速入门 + 学习路径）
├── cases/                            # 实战案例目录
│   ├── chatbot_customer_support.md   # 案例1：客服 Chatbot（Prompt + 变量 + 记忆）
│   ├── rag_knowledge_base.md         # 案例2：RAG 知识库问答（数据集 + 检索 + 引用）
│   └── workflow_tool_calling.md      # 案例3：工作流 + 工具调用（OpenAPI/HTTP）
├── data/                             # 验证数据目录
│   ├── faq_kb.md                     # FAQ 知识文档（用于知识库）
│   ├── order_policy.md               # 订单/售后规则文档（用于知识库）
│   ├── sample_queries.json           # 测试问题集（用于验证回答质量）
│   ├── tool_openapi.yaml             # 示例 OpenAPI（用于工具调用）
│   └── workflow_example.json         # 示例工作流描述（用于对照设计）
└── scripts/                          # 脚本/请求示例（不依赖真实环境也可阅读）
    ├── setup_notes.md                # 环境搭建与配置要点
    └── api_examples.md               # API 调用示例（curl 形式）
```

---

## 🎯 学习路径（建议 3~5 天）

### 阶段一：平台与概念（0.5~1 天）

1. **Dify 是什么**
   - 核心定位：快速构建可落地的 LLM 应用（Prompt + 记忆 + RAG + 工具 + 工作流）
   - 常见应用形态：聊天助手、知识库问答、自动化工作流、内部 Copilot

2. **基础对象**
   - 应用（App）：Chat/Workflow 等
   - 数据集（Dataset）：知识库文档、切分、索引
   - 工具（Tools）：HTTP/OpenAPI、函数/插件类工具（按平台能力理解）
   - 变量与上下文：系统提示词、用户输入、会话记忆、检索结果

### 阶段二：Prompt 与聊天应用（1 天）

1. **Prompt 设计**
   - 角色设定、边界与拒答策略
   - 输出结构化（JSON/Markdown 表格/要点）
   - 安全与合规：避免泄露敏感信息

2. **会话与记忆**
   - 何时开启记忆、如何控制上下文长度
   - 将“事实”沉淀到知识库，把“状态”留在会话

对应案例：`cases/chatbot_customer_support.md`

### 阶段三：RAG 知识库（1~2 天）

1. **知识库流程**
   - 文档准备 → 切分（chunk）→ 向量索引 → 检索 → 重排 → 引用

2. **质量与可验证**
   - 用问题集做回归（见 `data/sample_queries.json`）
   - 核对“可引用来源”的答案，减少幻觉

对应案例：`cases/rag_knowledge_base.md`

### 阶段四：工作流与工具调用（1~2 天）

1. **工作流（Workflow）**
   - 将复杂任务拆成可解释步骤：输入 → 检索 → 调用工具 → 汇总 → 输出

2. **工具调用**
   - OpenAPI/HTTP 工具：用标准接口做外部查询（见 `data/tool_openapi.yaml`）
   - 结果校验：字段缺失、错误码、超时重试（按平台能力设计）

对应案例：`cases/workflow_tool_calling.md`

---

## 🚀 快速开始（学习型）

> 这里以“学习与实践路径”为主，不绑定具体版本命令；环境搭建要点见 `scripts/setup_notes.md`。

### 步骤1：先跑通一个 Chat 应用

- 目标：能对话、能按格式输出、能控制回答边界  
- 验证：用 `data/sample_queries.json` 中的“客服类问题”测试

### 步骤2：再跑通一个知识库问答（RAG）

- 目标：回答必须可引用 `data/faq_kb.md` / `data/order_policy.md` 的内容  
- 验证：随机抽 10 个问题，对照文档逐条核对

### 步骤3：最后跑通一个“工作流 + 工具”用例

- 目标：当问题需要外部查询时走工具；不需要时直接回答  
- 验证：构造“需要工具”和“不需要工具”两类问题分别测试

---

## 📖 核心知识点速查

### 1. 应用形态

- **Chat 应用**：面向对话、带记忆与上下文管理
- **Workflow 应用**：面向流程编排、可控、可解释、适合自动化任务

### 2. RAG 的关键参数（学习时重点观察）

- **切分大小与重叠**：影响召回与上下文噪声
- **检索 TopK**：过小漏召回，过大带噪声
- **引用与回答策略**：要求“可追溯”，减少幻觉

### 3. 工具调用的关键点

- 输入输出 Schema：对齐字段名与类型
- 错误处理：异常/空结果/权限失败
- 防注入：对外部输入做约束与校验

---

## 📊 验证数据说明

| 文件 | 用途 | 如何验证 |
|------|------|----------|
| `data/faq_kb.md` | 知识库文档 | 问答需能引用对应段落 |
| `data/order_policy.md` | 规则文档 | “退款/售后/发票”类问答需与规则一致 |
| `data/sample_queries.json` | 回归测试集 | 每次改 Prompt/RAG 参数后回归 |
| `data/tool_openapi.yaml` | 工具接口示例 | 工作流中可用它模拟外部查询 |
| `data/workflow_example.json` | 工作流对照 | 用于理解节点与数据流转 |

---

## ✅ 学习检查清单

- [ ] 能搭建并运行一个 Chat 应用，输出格式稳定
- [ ] 能创建数据集并完成 RAG 问答，答案可引用来源
- [ ] 能编排一个工作流并接入工具，处理异常与空结果
- [ ] 能用问题集做回归验证，避免“改一次坏一次”

---

## 🎓 学习成果

完成本指南后，你将能够：

- 用 Dify 快速落地一个可用的 Chat/RAG/Workflow 应用
- 用验证数据与问题集做质量回归
- 用工具调用把 LLM 应用接入真实业务系统

