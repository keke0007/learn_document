# Flink å­¦ä¹ æŒ‡å—

## ğŸ“š é¡¹ç›®æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„ Flink å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬åŸºç¡€çŸ¥è¯†ã€å®æˆ˜æ¡ˆä¾‹å’ŒéªŒè¯æ•°æ®ï¼Œå¸®åŠ©ä½ ç³»ç»ŸæŒæ¡ Apache Flink æµå¤„ç†æŠ€æœ¯ã€‚æ‰€æœ‰æ¡ˆä¾‹éƒ½æä¾›äº† **Java** å’Œ **Scala** ä¸¤ç§å®ç°æ–¹å¼ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
flink/
â”œâ”€â”€ README.md                    # Flink çŸ¥è¯†ç‚¹æ€»è§ˆï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰
â”œâ”€â”€ GUIDE.md                     # æœ¬æŒ‡å—æ–‡æ¡£ï¼ˆå¿«é€Ÿå…¥é—¨ï¼‰
â”œâ”€â”€ cases/                       # å®æˆ˜æ¡ˆä¾‹ç›®å½•
â”‚   â”œâ”€â”€ datastream_basics.md     # æ¡ˆä¾‹1ï¼šDataStream åŸºç¡€æ“ä½œ
â”‚   â”œâ”€â”€ window_operations.md     # æ¡ˆä¾‹2ï¼šçª—å£æ“ä½œ
â”‚   â”œâ”€â”€ table_api.md             # æ¡ˆä¾‹3ï¼šTable API åº”ç”¨
â”‚   â””â”€â”€ realtime_analysis.md     # æ¡ˆä¾‹4ï¼šå®æ—¶æ•°æ®åˆ†æ
â”œâ”€â”€ data/                        # éªŒè¯æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ words.txt                # æ–‡æœ¬æ•°æ®
â”‚   â””â”€â”€ numbers.txt              # æ•°å­—æ•°æ®
â””â”€â”€ scripts/                     # è„šæœ¬å’Œé…ç½®æ–‡ä»¶
    â”œâ”€â”€ pom.xml                  # Java é¡¹ç›®é…ç½®ï¼ˆMavenï¼‰
    â””â”€â”€ build.sbt                # Scala é¡¹ç›®é…ç½®
```

---

## ğŸ¯ å­¦ä¹ è·¯å¾„

### é˜¶æ®µä¸€ï¼šFlink åŸºç¡€ï¼ˆ2-3å¤©ï¼‰
1. **Flink åŸºç¡€æ¦‚å¿µ**
   - äº†è§£ Flink æ¶æ„å’Œæ ¸å¿ƒç»„ä»¶
   - ç†è§£æµå¤„ç†å’Œæ‰¹å¤„ç†çš„åŒºåˆ«
   - æŒæ¡ StreamExecutionEnvironment

2. **DataStream API**
   - ç†è§£æ•°æ®æµæŠ½è±¡
   - å­¦ä¹  Sourceã€Transformationã€Sink
   - æŒæ¡åŸºæœ¬è½¬æ¢æ“ä½œ

### é˜¶æ®µäºŒï¼šçª—å£å’Œæ—¶é—´ï¼ˆ3-4å¤©ï¼‰
1. **çª—å£æ“ä½œ**
   - æ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£
   - ä¼šè¯çª—å£ã€è®¡æ•°çª—å£
   - çª—å£å‡½æ•°

2. **æ—¶é—´è¯­ä¹‰**
   - Event Timeã€Processing Time
   - æ°´ä½çº¿ï¼ˆWatermarkï¼‰
   - æ—¶é—´æˆ³åˆ†é…

### é˜¶æ®µä¸‰ï¼šTable API å’Œ SQLï¼ˆ2-3å¤©ï¼‰
1. **Table API**
   - Table åˆ›å»ºå’Œè½¬æ¢
   - Table API æ“ä½œ

2. **Flink SQL**
   - SQL æŸ¥è¯¢
   - çª—å£è¡¨å‡½æ•°
   - è¿æ¥å™¨é›†æˆ

### é˜¶æ®µå››ï¼šå®æˆ˜åº”ç”¨ï¼ˆ3-5å¤©ï¼‰
1. **å®æ—¶æ•°æ®åˆ†æ**
   - å®æ—¶ç»Ÿè®¡
   - å®æ—¶èšåˆ
   - å¤šç»´åº¦åˆ†æ

2. **çŠ¶æ€ç®¡ç†å’Œå®¹é”™**
   - çŠ¶æ€ç®¡ç†
   - Checkpoint
   - Savepoint

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

#### Java ç¯å¢ƒ
- Java 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Maven 3.6+

#### Scala ç¯å¢ƒ
- Scala 2.12
- sbtï¼ˆScala æ„å»ºå·¥å…·ï¼‰

#### Flink å®‰è£…
- ä¸‹è½½ Flink 1.17.0
- è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡

### æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡

#### Java é¡¹ç›®
```bash
# ä½¿ç”¨ Maven æ„å»ºé¡¹ç›®
cd flink/scripts
mvn clean package
```

#### Scala é¡¹ç›®
```bash
# ä½¿ç”¨ sbt æ„å»ºé¡¹ç›®
cd flink/scripts
sbt clean package
```

### æ­¥éª¤2ï¼šè¿è¡Œç¤ºä¾‹

#### Java ç¤ºä¾‹
```bash
# è¿è¡Œ DataStream åŸºç¡€ç¤ºä¾‹
flink run target/flink-learning-1.0.jar
```

#### Scala ç¤ºä¾‹
```bash
# è¿è¡Œ DataStream åŸºç¡€ç¤ºä¾‹
flink run target/scala-2.12/flink-learning_2.12-1.0.jar
```

### æ­¥éª¤3ï¼šéªŒè¯ç»“æœ
æ£€æŸ¥è¾“å‡ºå’Œæ§åˆ¶å°æ—¥å¿—ï¼ŒéªŒè¯ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

---

## ğŸ“– æ ¸å¿ƒçŸ¥è¯†ç‚¹é€ŸæŸ¥

### 1. DataStream API

| æ“ä½œç±»å‹ | æ–¹æ³• | è¯´æ˜ |
|---------|------|------|
| **Source** | `fromCollection()` | ä»é›†åˆåˆ›å»º |
| | `readTextFile()` | ä»æ–‡ä»¶è¯»å– |
| | `socketTextStream()` | Socket æ•°æ®æº |
| **Transformation** | `map()` | ä¸€å¯¹ä¸€è½¬æ¢ |
| | `filter()` | è¿‡æ»¤ |
| | `flatMap()` | ä¸€å¯¹å¤šè½¬æ¢ |
| | `keyBy()` | æŒ‰é”®åˆ†ç»„ |
| | `reduce()` | å½’çº¦ |
| **Sink** | `print()` | æ‰“å°è¾“å‡º |
| | `writeAsText()` | å†™å…¥æ–‡ä»¶ |

### 2. çª—å£æ“ä½œ

| çª—å£ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **æ»šåŠ¨çª—å£** | å›ºå®šå¤§å°ï¼Œä¸é‡å  | `TumblingEventTimeWindows.of(Time.seconds(5))` |
| **æ»‘åŠ¨çª—å£** | å›ºå®šå¤§å°ï¼Œæœ‰é‡å  | `SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5))` |
| **ä¼šè¯çª—å£** | åŸºäºæ´»åŠ¨é—´éš” | `EventTimeSessionWindows.withGap(Time.seconds(5))` |
| **è®¡æ•°çª—å£** | åŸºäºå…ƒç´ æ•°é‡ | `countWindow(100)` |

### 3. æ—¶é—´è¯­ä¹‰

```java
// è®¾ç½®äº‹ä»¶æ—¶é—´
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);

// åˆ†é…æ—¶é—´æˆ³å’Œæ°´ä½çº¿
.assignTimestampsAndWatermarks(
    WatermarkStrategy.<Event>forBoundedOutOfOrderness(Duration.ofSeconds(5))
        .withTimestampAssigner((event, timestamp) -> event.getTimestamp())
);
```

### 4. Table API & SQL

```java
// åˆ›å»º TableEnvironment
StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);

// å°† DataStream è½¬æ¢ä¸º Table
Table table = tableEnv.fromDataStream(dataStream);

// SQL æŸ¥è¯¢
tableEnv.createTemporaryView("table", dataStream);
Table result = tableEnv.sqlQuery("SELECT * FROM table");
```

---

## ğŸ’¡ å®æˆ˜æ¡ˆä¾‹æ¦‚è§ˆ

### æ¡ˆä¾‹1ï¼šDataStream åŸºç¡€æ“ä½œ
**å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡ DataStream API çš„åŸºæœ¬æ“ä½œ

**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- æ•°æ®æºåˆ›å»ºï¼ˆé›†åˆã€æ–‡ä»¶ï¼‰
- Transformationï¼ˆmapã€filterã€flatMapï¼‰
- é”®å€¼å¯¹æ“ä½œï¼ˆkeyByã€reduceï¼‰
- æ•°æ®è¾“å‡ºï¼ˆprintã€writeAsTextï¼‰

**æ•°æ®è§„æ¨¡**ï¼š
- æ–‡æœ¬æ–‡ä»¶ï¼š6 è¡Œ
- æ•°å­—æ–‡ä»¶ï¼š3 è¡Œ

**å…¸å‹æ“ä½œ**ï¼š
- å•è¯è®¡æ•°
- æ•°æ®è¿‡æ»¤å’Œè½¬æ¢
- é”®å€¼å¯¹èšåˆ

### æ¡ˆä¾‹2ï¼šçª—å£æ“ä½œ
**å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡ Flink çª—å£æ“ä½œ

**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- æ»šåŠ¨çª—å£
- æ»‘åŠ¨çª—å£
- ä¼šè¯çª—å£
- è®¡æ•°çª—å£
- çª—å£å‡½æ•°

**æ•°æ®è§„æ¨¡**ï¼š
- è®¢å•æ•°æ®ï¼š8 æ¡è®°å½•

**å…¸å‹æ“ä½œ**ï¼š
- æ—¶é—´çª—å£èšåˆ
- è®¡æ•°çª—å£èšåˆ
- çª—å£å‡½æ•°åº”ç”¨

### æ¡ˆä¾‹3ï¼šTable API åº”ç”¨
**å­¦ä¹ ç›®æ ‡**ï¼šä½¿ç”¨ Table API å’Œ SQL è¿›è¡Œæ•°æ®å¤„ç†

**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- Table åˆ›å»ºå’Œè½¬æ¢
- Table API æ“ä½œ
- SQL æŸ¥è¯¢
- çª—å£è¡¨å‡½æ•°

**æ•°æ®è§„æ¨¡**ï¼š
- è®¢å•æ•°æ®ï¼š5 æ¡è®°å½•

**å…¸å‹æ“ä½œ**ï¼š
- Table API é“¾å¼æ“ä½œ
- SQL æŸ¥è¯¢
- çª—å£è¡¨å‡½æ•°

### æ¡ˆä¾‹4ï¼šå®æ—¶æ•°æ®åˆ†æ
**å­¦ä¹ ç›®æ ‡**ï¼šè¿›è¡Œå®æ—¶æ•°æ®åˆ†æ

**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼š
- å®æ—¶ç»Ÿè®¡
- å®æ—¶èšåˆ
- å¤šç»´åº¦åˆ†æ
- è½¬åŒ–ç‡è®¡ç®—

**æ•°æ®è§„æ¨¡**ï¼š
- ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š6 æ¡è®°å½•

**å…¸å‹åˆ†æ**ï¼š
- ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡
- äº§å“çƒ­åº¦ç»Ÿè®¡
- è½¬åŒ–ç‡åˆ†æ

---

## ğŸ“Š æ•°æ®è¯´æ˜

### æ•°æ®æ–‡ä»¶æ ¼å¼

| æ–‡ä»¶å | æ ¼å¼ | è®°å½•æ•° | ç”¨é€” | æ¡ˆä¾‹ |
|--------|------|--------|------|------|
| words.txt | æ–‡æœ¬ | 6 è¡Œ | æ–‡æœ¬å¤„ç† | æ¡ˆä¾‹1 |
| numbers.txt | CSV | 3 è¡Œ | æ•°å­—å¤„ç† | æ¡ˆä¾‹1 |

### æ•°æ®å­—æ®µè¯´æ˜

**words.txt** æ ¼å¼ï¼š
- æ¯è¡Œä¸€ä¸ªå¥å­ï¼Œå•è¯ç”¨ç©ºæ ¼åˆ†éš”

**numbers.txt** æ ¼å¼ï¼š
- CSV æ ¼å¼ï¼Œé€—å·åˆ†éš”

---

## ğŸ”§ ä½¿ç”¨æŠ€å·§

### 1. Java vs Scala

**Java ä¼˜åŠ¿**ï¼š
- ç±»å‹å®‰å…¨
- ä¼ä¸šçº§åº”ç”¨å¹¿æ³›
- ä¸°å¯Œçš„å·¥å…·ç”Ÿæ€

**Scala ä¼˜åŠ¿**ï¼š
- è¯­æ³•ç®€æ´
- å‡½æ•°å¼ç¼–ç¨‹
- ä¸ Spark ç”Ÿæ€å…¼å®¹

**é€‰æ‹©å»ºè®®**ï¼š
- ä¼ä¸šé¡¹ç›®ï¼šæ¨è Java
- æ•°æ®ç§‘å­¦ï¼šæ¨è Scala
- å­¦ä¹ é˜¶æ®µï¼šä¸¤ç§éƒ½å­¦

### 2. æ€§èƒ½ä¼˜åŒ–

```java
// è®¾ç½®å¹¶è¡Œåº¦
env.setParallelism(4);

// å¯ç”¨ Checkpoint
env.enableCheckpointing(60000);

// ä½¿ç”¨çŠ¶æ€åç«¯
env.setStateBackend(new FsStateBackend("hdfs://path"));
```

### 3. å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šæ°´ä½çº¿å»¶è¿Ÿ**
```java
// å¢åŠ æ°´ä½çº¿å»¶è¿Ÿå®¹å¿åº¦
WatermarkStrategy.forBoundedOutOfOrderness(Duration.ofSeconds(10))
```

**é—®é¢˜2ï¼šçŠ¶æ€è¿‡å¤§**
```java
// ä½¿ç”¨ RocksDB çŠ¶æ€åç«¯
env.setStateBackend(new RocksDBStateBackend("hdfs://path"));
```

**é—®é¢˜3ï¼šèƒŒå‹ï¼ˆBackpressureï¼‰**
```java
// è°ƒæ•´ç¼“å†²åŒºå¤§å°
env.setBufferTimeout(100);
```

---

## ğŸ“ å­¦ä¹ å»ºè®®

### åˆå­¦è€…
1. å…ˆå­¦ä¹  Java å®ç°ï¼ˆè¯­æ³•æ›´ç†Ÿæ‚‰ï¼‰
2. ä»æ¡ˆä¾‹1å¼€å§‹ï¼Œé€æ­¥ç»ƒä¹ 
3. ç†è§£æµå¤„ç†å’Œæ‰¹å¤„ç†çš„åŒºåˆ«
4. æŒæ¡çª—å£æ“ä½œå’Œæ—¶é—´è¯­ä¹‰

### è¿›é˜¶å­¦ä¹ 
1. å­¦ä¹  Scala å®ç°ï¼ˆå‡½æ•°å¼é£æ ¼ï¼‰
2. å®Œæˆæ‰€æœ‰å››ä¸ªæ¡ˆä¾‹
3. å­¦ä¹ çŠ¶æ€ç®¡ç†å’Œå®¹é”™
4. å°è¯•è¿æ¥ Kafka ç­‰å¤–éƒ¨ç³»ç»Ÿ

### å®è·µå»ºè®®
1. **åŠ¨æ‰‹å®è·µ**ï¼šä¸è¦åªçœ‹ä»£ç ï¼Œè¦å®é™…è¿è¡Œ
2. **ç†è§£åŸç†**ï¼šäº†è§£ Flink çš„æ‰§è¡Œæœºåˆ¶
3. **æ€§èƒ½è°ƒä¼˜**ï¼šå­¦ä¹ å¦‚ä½•ä¼˜åŒ– Flink ä½œä¸š
4. **ç”Ÿäº§å®è·µ**ï¼šå­¦ä¹ éƒ¨ç½²å’Œè¿ç»´

---

## ğŸ”— ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Apache Flink å®˜æ–¹æ–‡æ¡£](https://flink.apache.org/docs/)
- [Flink DataStream API](https://flink.apache.org/docs/latest/dev/datastream_api.html)
- [Flink Table API & SQL](https://flink.apache.org/docs/latest/dev/table/)

### æ¨èé˜…è¯»
- `README.md` - è¯¦ç»†çš„çŸ¥è¯†ç‚¹æ–‡æ¡£
- `cases/` - å››ä¸ªå®æˆ˜æ¡ˆä¾‹çš„è¯¦ç»†è¯´æ˜
- Flink å®˜æ–¹ç¤ºä¾‹ä»£ç 

### æ‰©å±•å­¦ä¹ 
- Flink CEPï¼šå¤æ‚äº‹ä»¶å¤„ç†
- Flink MLï¼šæœºå™¨å­¦ä¹ 
- Flink Gellyï¼šå›¾è®¡ç®—
- Flink éƒ¨ç½²å’Œè¿ç»´

---

## âœ… å­¦ä¹ æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼Œç¡®ä¿æŒæ¡ Flink æ ¸å¿ƒæŠ€èƒ½ï¼š

### åŸºç¡€æ“ä½œ
- [ ] èƒ½å¤Ÿåˆ›å»º DataStream
- [ ] èƒ½å¤Ÿæ‰§è¡ŒåŸºæœ¬çš„ Transformation
- [ ] èƒ½å¤Ÿä½¿ç”¨çª—å£æ“ä½œ
- [ ] èƒ½å¤Ÿè®¾ç½®æ—¶é—´è¯­ä¹‰å’Œæ°´ä½çº¿

### è¿›é˜¶æ“ä½œ
- [ ] èƒ½å¤Ÿä½¿ç”¨ Table API å’Œ SQL
- [ ] èƒ½å¤Ÿè¿›è¡ŒçŠ¶æ€ç®¡ç†
- [ ] èƒ½å¤Ÿé…ç½® Checkpoint
- [ ] èƒ½å¤Ÿä½¿ç”¨è¿æ¥å™¨

### å®æˆ˜èƒ½åŠ›
- [ ] å®Œæˆæ¡ˆä¾‹1çš„æ‰€æœ‰æ“ä½œ
- [ ] å®Œæˆæ¡ˆä¾‹2çš„æ‰€æœ‰çª—å£æ“ä½œ
- [ ] å®Œæˆæ¡ˆä¾‹3çš„ Table API åº”ç”¨
- [ ] å®Œæˆæ¡ˆä¾‹4çš„å®æ—¶åˆ†æ
- [ ] èƒ½å¤Ÿç‹¬ç«‹è®¾è®¡ Flink åº”ç”¨

---

## ğŸ“ å­¦ä¹ æˆæœ

å®Œæˆæœ¬æŒ‡å—çš„å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… ç†Ÿç»ƒä½¿ç”¨ Flink è¿›è¡Œæµæ•°æ®å¤„ç†
- âœ… æŒæ¡ DataStream API çš„æ“ä½œ
- âœ… èƒ½å¤Ÿä½¿ç”¨ Table API å’Œ SQL
- âœ… ç†è§£çª—å£æ“ä½œå’Œæ—¶é—´è¯­ä¹‰
- âœ… å…·å¤‡ç‹¬ç«‹å¼€å‘ Flink åº”ç”¨çš„èƒ½åŠ›
- âœ… æŒæ¡ Java å’Œ Scala ä¸¤ç§å®ç°æ–¹å¼

**ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼** ğŸš€

---

## ğŸ“Œ å¿«é€Ÿå‚è€ƒ

### å¯åŠ¨ Flink é›†ç¾¤

```bash
# å¯åŠ¨é›†ç¾¤
./bin/start-cluster.sh

# åœæ­¢é›†ç¾¤
./bin/stop-cluster.sh
```

### æäº¤ä½œä¸š

```bash
# æäº¤ä½œä¸š
flink run -c MainClass app.jar

# æŸ¥çœ‹ä½œä¸šåˆ—è¡¨
flink list

# å–æ¶ˆä½œä¸š
flink cancel <jobId>
```

### å¸¸ç”¨é…ç½®

```bash
# è®¾ç½®å¹¶è¡Œåº¦
flink run -p 4 app.jar

# è®¾ç½® Checkpoint é—´éš”
# åœ¨ä»£ç ä¸­é…ç½®ï¼šenv.enableCheckpointing(60000)
```
